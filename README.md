# Инженерный калькулятор 2.0

Мини-проект, реализованный на HTML/CSS/JavaScript. Он развивает учебный калькулятор из главы 5 и добавляет инженерные функции, историю вычислений, поддержку горячих клавиш и переключение темы.

## Как пользоваться

- Вводите выражение кнопками или с клавиатуры, результат отображается после `=`. Поле выражения всегда показывает то, что вы набрали.
- Клавиша `C` очищает ввод, `⌫` удаляет последний символ.
- Панель истории скрывается/показывается кнопкой «История». Клик по записи возвращает выражение и результат на экран. Хранится до 30 записей, «Очистить» сбрасывает список.
- Кнопка «Копировать» копирует текущий результат в буфер обмена.
- Переключатель темы меняет светлую/темную тему; учитываются системные настройки, выбор запоминается в `localStorage`.

## Гибкий ввод и синтаксис

- Числа: `0–9`, десятичная точка `.` (одна в числе). Одиночная точка без цифр вызывает ошибку «Некорректное число».
- Операторы: `+ - * / ^`. При повторном вводе двух операторов подряд последний заменяет предыдущий. В начале допустим только `-` (унарный минус).
- Унарный минус (`-x`) — отдельный оператор: `-5`, `5*-3`, `(-3)` работают корректно. Приоритет высокий, поэтому `-3^2` считается как `(-3)^2`.
- Скобки: `(` и `)` требуют балансировки, ошибки подсвечиваются.
- Степени: кнопка `xʸ` или символ `^`; запись `2^3^2` правая ассоциативность → `2^(3^2)=512`. Также распознаётся `**` как `^`.
- Корень: символ `√` как префиксный оператор.
- Функции: `sin`, `cos`, `tan`, `asin`, `acos`, `atan`, `ln`, `log(base, value)`, `abs(x)`. Всегда требуются скобки; для аргументов используйте запятую `,`.
- Модуль: `|x|` автоматически преобразуется в `abs(x)`; вложенные модули поддерживаются.
- Константы: `π`, `pi`, `e`.
- Постфиксные операторы: `!` (факториал), `%` (проценты) ставятся только после операнда (`число`, `)`, `π`, `e`, `!`).

## Особенности вычислений и ограничения

- Проценты: `a + b%` и `a - b%` трактуются как процент от левого операнда (`a + a*b/100`). В других контекстах `%` превращается в долю (`b/100`), например `100 * 10% = 10`.
- Факториал: только для целых `>= 0`, ограничение по размеру `<= 170`. Снова применять `!` к результату можно, но при превышении лимита получите ошибку «Слишком большое число для факториала».
- Деление на ноль запрещено, выдаёт ошибку.
- Логарифмы и тригонометрия проверяют домены: `ln(x)` и `log(base, x)` требуют положительных аргументов; `asin`/`acos` работают только в `[-1;1]`.
- Скрытое умножение не поддерживается: пишите `2*(3+4)`, а не `2(3+4)`.
- Двойные точки в числе (`1.2.3`) или лишние скобки/вертикальные черты приводят к понятным сообщениям об ошибке.

## Возможности

- Базовые операции: сложение, вычитание, умножение, деление.
- Расширенные операции: возведение в степень `xʸ`, корень `√`, факториал `!`, проценты `%`, модуль `|x|/abs`.
- Тригонометрия: `sin`, `cos`, `tan`, `asin`, `acos`, `atan`.
- Логарифмы: `ln`, `log(base, value)`.
- Константы: `π`, `e`.
- Скобки, приоритеты операций и комбинированные выражения.
- История вычислений с очисткой и повторным использованием результатов.
- Копирование результата в буфер обмена.
- Светлая и тёмная тема (с учётом системных настроек).
- Управление с клавиатуры и кнопками UI.
- Обработка ошибок: деление на ноль, неверный ввод, пустые выражения, некорректные аргументы функций.

## Структура проекта

```
├── index.html        # Разметка интерфейса (toolbar, калькулятор, история)
├── style.css         # Стили, темы, сетки, доступность
└── calculator.js     # Логика: парсер, вычисления, UI
```

### `index.html`

- Контейнер `.app` с панелью инструмента (переключатель темы, доступ к истории).
- Блок дисплея (`#expr`, `#result`) и кнопка копирования `#copyResult`.
- Сетка кнопок с `data-value`/`data-action`, включая инженерные функции.
- Боковая панель `#historyPanel` с заголовком, очисткой и списком истории.
- Скрипт `calculator.js` подключён с `defer`.

### `style.css`

- CSS‑переменные и переключение темы через `data-theme`.
- Сетки и адаптивность для клавиш и истории.
- Визуальные состояния для доступности и активных элементов.

### `calculator.js`

- Управление DOM и состоянием выражения/истории.
- Токенизация, алгоритм шунтующей станции (Shunting Yard), вычисление RPN.
- Поддержка модулей, функций, констант, префиксных, инфиксных и постфиксных операторов.
- Обработка событий UI, клавиатуры, копирования и темы.

## Горячие клавиши

- `0`–`9`, `.` — ввод цифр и десятичной точки.
- `+`, `-`, `*`, `/`, `^` — операторы.
- `%`, `!`, `(`, `)` — специальные символы.
- `Enter` или `=` — вычисление выражения.
- `Backspace` — удаление последнего символа.
- `Escape` — очистка выражения.

## Обработка ошибок

- Деление на ноль (`OPERATORS['/']`).
- Недостаток аргументов функций/операторов.
- Некорректные символы и запятые вне функций.
- Несбалансированные скобки и пары `|...|`.
- Некорректные аргументы `ln`, `log`, `asin`, `acos`, `√`, `factorial`.
- Пустое выражение при вычислении.

Ошибки отображаются в поле результата, а подробности выводятся в консоль.

## Примеры выражений

| Ввод | Результат |
| --- | --- |
| `sin(π/2)` | `1` |
| `log(2, 32)` | `5` |
| `√(9) + 4^2` | `19` |
| `|−7| + 15%` | `8.05` |
| `5! / (3! * 2!)` | `10` |
| `100 + 10%` | `110` |
| `-3^2` | `9` |
| `2*(3+4)` | `14` |

## Требования к окружению

Современный браузер с поддержкой ES6 и Clipboard API. Для запуска откройте `index.html`.

